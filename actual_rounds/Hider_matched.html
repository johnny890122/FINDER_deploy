{{ block title }}
    Round {{which_round}} Matching Result
{{ endblock }}
{{ block content }}
    <head>
      <script src="//unpkg.com/force-graph"></script>
    </head>

    <body>
        媒合的結果 & Payoff
        <div id="graph" style="border-color:black;border-width:1px;border-style:solid;padding:5px;"></div>
    </body>

    <script>
        // Random tree
        const gData = {
            nodes: {{nodes}}, 
            links: {{links}}
        }
        const NODE_R = 5;

        const highlightNodes = new Set();
        const highlightLinks = new Set();
        let hoverNode = null;

        const elem = document.getElementById('graph');

        const Graph = ForceGraph()
          (document.getElementById('graph'))
            .width(800)
            .height(500)
            .nodeLabel('id')
            .graphData(gData)

            .onNodeClick(node => {
              document.getElementById("node_id").value = node.id == {{me}} ? node.id + " (You)": node.id;
              document.getElementById("degree").value = node.degree;
              document.getElementById("geo_d").value = node.geo_d;
              document.getElementById("common_neighbor").value = node.common_neighbor;
              document.getElementById('confirm_block').style.display = 'block';

              if (node) {
                // highlightNodes.add(node);
                focus_node = node;
                if (node.neighbors) {
                    node.neighbors.forEach(neighbor => {
                        highlightNodes.add(neighbor)
                    });
                if (node.links) {
                    node.links.forEach(link => highlightLinks.add(link));
                    }    
                }
              }
              hoverNode = node || null;
              console.log(highlightNodes);
              console.log(typeof highlightNodes);
            })
            .autoPauseRedraw(false) // keep redrawing after engine has stopped
            .nodeCanvasObject((node, ctx) => {
              ctx.beginPath();
              if (node.id == {{me}}){
                ctx.fillStyle = "#2F4F4F";
                ctx.beginPath(); ctx.moveTo(x, y - 5); ctx.lineTo(x - 5, y + 5); ctx.lineTo(x + 5, y + 5);
                ctx.fill();
              }

              else if (highlightNodes.has(node)){
                ctx.fillStyle = "#8FBC8F";
                // ctx.fillRect(node.x - 6, node.y - 6, 12, 12);
                // ctx.arc(node.x, node.y, NODE_R, 0, 2 * Math.PI, false);
                ctx.beginPath(); ctx.moveTo(x, y - 5); ctx.lineTo(x - 5, y + 5); ctx.lineTo(x + 5, y + 5);
              }
              else {
                ctx.fillStyle = "#2F4F4F"
                // ctx.arc(node.x, node.y, NODE_R, 0, 2 * Math.PI, false);
              }
              
            });
    </script>

{{ next_button }}

{{ endblock }}