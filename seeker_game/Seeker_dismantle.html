{{ block title }}
		{{ if stage == "basic"}}
			Page 2: Round {{which_round}} 
		{{ elif stage == "HDA"}}
			Page 4: Round {{which_round}} 
		{{ elif stage == "HCA"}}
			Page 5: Round {{which_round}} 
		{{ elif stage == "HBA"}}
			Page 6: Round {{which_round}} 
		{{ elif stage == "HPRA"}}
			Page 7: Round {{which_round}} 
		{{ else }}
			Page 10: Round {{which_round}} 
		{{ endif }}
{{ endblock }}

{{ block content }}
	<head>
		<script src="//unpkg.com/force-graph"></script>
		<script>
			function cancel() {
				document.getElementById("id_to_be_removed").value = null;
				document.getElementById('confirm_block').style.display = "none";
				highlight_node.clear()
			}
		</script>


		<style>
		.outer {
		  display: flex;
		  justify-content: center;
		  align-items: center;
		}

		.middle {
		  display: flex;
		  flex-direction: column;
		}

		</style>
	</head>

	<body>
		<div class="outer">
			<div class="middle">
			<div class="mb-3 _formfield">
				<label class="col-form-label" for="id_to_be_removed">
					您選擇的節點為：
				</label>
				<div class="controls">
					<input type="number" class="form-control" inputmode="numeric" id="id_to_be_removed" min="0" name="to_be_removed" required="" value="" placeholder="尚未選擇任何節點">
				</div>
			</div>

			<div id="confirm_block" style="display: none;">
					<p>確定要選擇此節點嗎？</p>
					<p id ="info" style="display: block;"> </p>
					<!-- <ul> -->
							<!-- <li>Degree: <p id ="degree" style="display: inline;"/></li>
							<li>Closeness: <p id ="closeness" style="display: inline;"/></li>
							<li>Betweenness: <p id ="betweenness" style="display: inline;"/></li>
							<li>Pagerank: <p id ="pagerank" style="display: inline;"/></li>
					</ul> -->
					
					<button id="yes_button" class="otree-btn-next btn btn-primary">
							是，前往下一頁。
					</button>

					<!-- Fake button -->
					<div id="no_button" class="otree-btn-next btn btn-primary" onclick="cancel()" 
							style="background-color: gray; border-color: gray;">
							否，取消。
					</div>         
			</div>

			<div id="graph" 
					style="border-color: black; border-width: 1px; border-style: solid; padding:5px; width:fit-content;"></div>

			<script>
				const gData = { nodes: {{nodes}}, links: {{links}} };
				const stage = "{{stage}}"
				const tool = "{{tool}}"
				const degree_color = {{degree_color}};
				const closeness_color = {{closeness_color}};
				const betweenness_color = {{betweenness_color}};
				const page_rank_color = {{page_rank_color}};

				const degree_ranking = {{degree_ranking}};
				const closeness_ranking = {{closeness_ranking}};
				const betweenness_ranking = {{betweenness_ranking}};
				const page_rank_ranking = {{page_rank_ranking}};
				const NODE_R = 10;
				let highlight_node = new Set();

				const Graph = ForceGraph()
					(document.getElementById('graph'))
					.graphData(gData)
					.width(1400)
					.height(800)
					.minZoom(1)
					.maxZoom(1)
					.linkWidth(2)
					.linkColor(link => "#000000")
					.linkVisibility(link => link["display"] == "False" ? false : true)
					.nodeVisibility(node => node["display"] == "False" ? false : true)
					.onNodeClick(node => {
						let info = ''

						highlight_node.clear();
						document.getElementById("id_to_be_removed").value = node.id;
						document.getElementById('confirm_block').style.display = "block";
						// document.getElementById("degree").innerHTML = node.degree;
						// document.getElementById("closeness").innerHTML = node.closeness;
						// document.getElementById("betweenness").innerHTML = node.betweenness;
						// document.getElementById("pagerank").innerHTML = node.pagerank;
						// document.getElementById("info").innerHTML = node;
						if (stage == "basic" || (stage=="official" && tool == "no_help")) {
							document.getElementById('info').style.display = "none";
						}
						else if (stage == "HDA" || (stage=="official" && tool == "degree")){
							document.getElementById("info").innerHTML = "Degree Rank " + degree_ranking[node.id]
						}
						else if (stage == "HCA" || (stage=="official" && tool == "closeness")){
							document.getElementById("info").innerHTML = "Closeness Rank " + closeness_ranking[node.id]
						}
						else if (stage == "HBA" || (stage=="official" && tool == "betweenness")){
							document.getElementById("info").innerHTML = "Betweenness Rank " + betweenness_ranking[node.id]
						}
						else if (stage == "HPRA" || (stage=="official" && tool == "page_rank")){
							document.getElementById("info").innerHTML = "Page rank Rank " + page_rank_ranking[node.id]
						}
						document.getElementById('info').style.display = "block";

						highlight_node.add(node);
					})
					.nodeCanvasObject((node, ctx) => {
					// 預設的著色
					ctx.strokeStyle = '#568EA6';
					if (stage == "basic" || (stage=="official" && tool == "no_help")) {
						ctx.fillStyle = "#ffffff";
					}
					else if (stage == "HDA" || (stage=="official" && tool == "degree")){
						ctx.fillStyle = degree_color[node.id];
					}
					else if (stage == "HCA" || (stage=="official" && tool == "closeness")){
						ctx.fillStyle = closeness_color[node.id];
					}
					else if (stage == "HBA" || (stage=="official" && tool == "betweenness")){
						ctx.fillStyle = betweenness_color[node.id];
					}
					else if (stage == "HPRA" || (stage=="official" && tool == "page_rank")){
						ctx.fillStyle = page_rank_color[node.id];
					}
					else{
						ctx.fillStyle = "#ffffff";
					}
					

					// 標註被選中的 node
					if (highlight_node.has(node)) {
						ctx.fillStyle = "#B22222";
						ctx.strokeStyle = "#B22222";
					}

					ctx.beginPath(); ctx.arc(node.x, node.y, NODE_R, 0, 2 * Math.PI, false); ctx.closePath();
					ctx.fill()
					ctx.stroke()
				})
			Graph.d3Force('center', null);
			Graph.onEngineTick(() => Graph.zoomToFit(0, 10, node => true));
			</script>
			</div>
		</div>
	</body>

{{ endblock }}
